<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shows</title>
    <link rel="stylesheet" href="../socs.css">
    <link rel="icon" type="image/png" href="web/soldoutlogo.png">
</head>
<body>
    <!-- Show Section - Self-contained -->
    <section id="show-section">
        <div class="shows-container">
            <div class="shows-list" id="shows-list"></div>
            <div id="no-shows" class="no-shows-message" style="display: none;">
                <h2>NO UPCOMING SHOWS</h2>
                <p>Check back soon for new show announcements!</p>
            </div>
        </div>

        <script>
            // Show JavaScript - Scoped to avoid conflicts
            (function() {
                function parseDate(dateStr) {
                    if (dateStr.includes('-')) {
                        return new Date(dateStr);
                    } else {
                        return new Date(dateStr);
                    }
                }
                
                function formatDisplayDate(date) {
                    const today = new Date();
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    const tomorrow = new Date(today);
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    
                    const compareDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
                    const compareToday = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                    const compareYesterday = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate());
                    const compareTomorrow = new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate());
                    
                    if (compareDate.getTime() === compareToday.getTime()) {
                        return 'Today';
                    } else if (compareDate.getTime() === compareYesterday.getTime()) {
                        return 'Yesterday';
                    } else if (compareDate.getTime() === compareTomorrow.getTime()) {
                        return 'Tomorrow';
                    } else {
                        return date.toLocaleDateString('en-US', { 
                            weekday: 'long',
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        });
                    }
                }
                
                function shouldShowShow(showDate) {
                    const today = new Date();
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    const compareDate = new Date(showDate.getFullYear(), showDate.getMonth(), showDate.getDate());
                    const compareYesterday = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate());
                    
                    return compareDate >= compareYesterday;
                }
                
                function createShowElement(show, showType, colorIndex) {
                    const container = document.createElement('div');
                    container.className = `ticket-container ${showType}-edition`;
                    
                    // Define 7 different background colors for title headers (no red or blue shades)
                    const headerColors = [
                        'linear-gradient(135deg, #2ed573, #27ae60)', // Green  
                        'linear-gradient(135deg, #ffa502, #ff6348)', // Orange
                        'linear-gradient(135deg, #9c88ff, #8c7ae6)', // Purple
                        'linear-gradient(135deg, #ff6b9d, #e84393)', // Pink
                        'linear-gradient(135deg, #f1c40f, #f39c12)', // Yellow
                        'linear-gradient(135deg, #00d2d3, #01a3a4)', // Teal
                        'linear-gradient(135deg, #a55eea, #8854d0)'  // Violet
                    ];
                    
                    const headerBg = headerColors[colorIndex % 7];
                    
                    const showDate = parseDate(show.querySelector('date').textContent);
                    const displayDate = formatDisplayDate(showDate);
                    
                    const location = show.querySelector('location');
                    const locationUrl = show.querySelector('locationUrl');
                    const locationHtml = location ? 
                        (locationUrl ? 
                            `<a href="${locationUrl.textContent}" target="_blank" class="location-link">${location.textContent}</a>` :
                            `<span class="detail-value">${location.textContent}</span>`
                        ) : '';
                    
                    container.innerHTML = `
                        <div class="decorative-elements">
                            ${showType === 'screen' ? 
                                '<div class="star">‚ú®</div><div class="star">‚≠ê</div><div class="star">‚ú®</div><div class="star">‚≠ê</div><div class="star">üí´</div><div class="star">üåü</div>' :
                                '<div class="star">‚≠ê</div><div class="star">‚ú®</div><div class="star">‚≠ê</div><div class="star">‚ú®</div>'
                            }
                        </div>
                        
                        <div class="ticket-header" style="background: ${headerBg};">
                            <h1 class="show-title" style="color: white;">${show.querySelector('title').textContent}</h1>
                        </div>
                        
                        <div class="sold-out-banner ${showType}-edition">
                            A <strong>SOLD OUT!</strong> Comedy Show<br>
                            <span class="smaller-text">${showType === 'screen' ? 'Screen Edition (online audience only)' : 'Stage Edition (in-person and online audience)'}</span>
                        </div>
                        
                        <div class="ticket-body">
                            <div class="show-details">
                                <div class="detail-row">
                                    <span class="detail-label">Date:</span>
                                    <span class="detail-value">${displayDate}</span>
                                </div>
                                
                                ${showType === 'stage' ? `
                                <div class="detail-row">
                                    <span class="detail-label">Merch Check-In:</span>
                                    <span class="detail-value">${show.querySelector('merchStartTime').textContent} - ${show.querySelector('merchEndTime').textContent} CT</span>
                                </div>
                                ` : ''}
                                
                                <div class="detail-row">
                                    <span class="detail-label">Show Time:</span>
                                    <span class="detail-value">${show.querySelector('time').textContent} CT</span>
                                </div>
                                
                                ${showType === 'stage' && locationHtml ? `
                                <div class="detail-row">
                                    <span class="detail-label">Location:</span>
                                    <span class="detail-value">${locationHtml}</span>
                                </div>
                                ` : ''}
                            </div>
                            
                            <div class="buttons-container">
                                ${showType === 'stage' ? `
                                <a href="${show.querySelector('liveUrl') ? show.querySelector('liveUrl').textContent : '#'}" class="ticket-button live-button">
                                    $10 LIVE TIX
                                </a>
                                ` : ''}
                                <a href="${show.querySelector('onlineUrl') ? show.querySelector('onlineUrl').textContent : '#'}" class="ticket-button online-button ${showType === 'screen' ? 'screen-edition' : ''}">
                                    WATCH FREE ONLINE
                                </a>
                            </div>
                        </div>
                        
                        <div class="zigzag-border"></div>
                    `;
                    
                    return container;
                }
                
                async function loadShows() {
                    try {
                        const response = await fetch('shows.xml');
                        const xmlText = await response.text();
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
                        
                        const shows = Array.from(xmlDoc.querySelectorAll('show'));
                        const showsList = document.getElementById('shows-list');
                        const noShowsMessage = document.getElementById('no-shows');
                        
                        const filteredShows = shows.filter(show => {
                            const showDate = parseDate(show.querySelector('date').textContent);
                            return shouldShowShow(showDate);
                        });
                        
                        filteredShows.sort((a, b) => {
                            const dateA = parseDate(a.querySelector('date').textContent);
                            const dateB = parseDate(b.querySelector('date').textContent);
                            return dateA - dateB;
                        });
                        
                        if (filteredShows.length === 0) {
                            noShowsMessage.style.display = 'block';
                            return;
                        }
                        
                        filteredShows.forEach((show, index) => {
                            const showType = show.getAttribute('type');
                            const showElement = createShowElement(show, showType, index);
                            showsList.appendChild(showElement);
                        });
                        
                    } catch (error) {
                        console.error('Error loading shows:', error);
                        const showsList = document.getElementById('shows-list');
                        showsList.innerHTML = `
                            <div class="no-shows-message">
                                <h2>ERROR LOADING SHOWS</h2>
                                <p>Please check that shows.xml is available.</p>
                            </div>
                        `;
                    }
                }
                
                // Load shows when this script runs
                loadShows();
            })();
        </script>
    </section>
</body>
</html>