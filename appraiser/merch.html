<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sell Your Merch</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <link rel="icon" type="image/png" href="../web/soldoutlogo.png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Helvetica Neue', 'Arial', sans-serif; background: #f5f5f5; color: #1a1a1a; line-height: 1.4; padding: 16px 0; -webkit-font-smoothing: antialiased; }
        .container { max-width: 420px; margin: 0 auto; background: #ffffff; border: 1px solid #e0e0e0; overflow: hidden; }
        .header { background: #f0f0f0; color: #333333; padding: 32px 24px; border-bottom: 1px solid #d0d0d0; display: flex; align-items: center; gap: 16px; }
        .header-logo { width: 72px; height: 72px; flex-shrink: 0; }
        .header-content { flex: 1; }
        .header h1 { font-size: 28px; font-weight: 300; margin-bottom: 12px; letter-spacing: -0.02em; color: #444444; }
        .header p { font-size: 13px; color: #777777; margin-bottom: 0; font-weight: 400; }
        .form-section { display: none; padding: 32px 24px; border-bottom: 1px solid #e8e8e8; }
        .form-section.active { display: block; }
        .form-section h2 { font-size: 20px; font-weight: 400; margin-bottom: 8px; color: #1a1a1a; letter-spacing: -0.01em; }
        .form-section p { font-size: 13px; color: #666666; margin-bottom: 28px; line-height: 1.5; }
        .form-group { margin-bottom: 24px; }
        label { display: block; font-size: 12px; font-weight: 500; margin-bottom: 8px; color: #444444; text-transform: uppercase; letter-spacing: 0.02em; }
        input[type="text"], input[type="email"], input[type="number"], textarea { width: 100%; padding: 16px; border: 1px solid #cccccc; background: #fafafa; font-size: 15px; font-family: inherit; transition: all 0.15s ease; color: #1a1a1a; }
        input:focus, textarea:focus { outline: none; border-color: #666666; background: #ffffff; }
        input.error { border-color: #999999; background: #f8f8f8; }
        .error-message { color: #777777; font-size: 11px; margin-top: 6px; font-weight: 400; }
        .radio-group { display: flex; flex-direction: column; gap: 2px; }
        .radio-option { display: flex; align-items: center; padding: 16px; border: 1px solid #e0e0e0; background: #fafafa; cursor: pointer; transition: all 0.15s ease; }
        .radio-option:hover { border-color: #cccccc; background: #f5f5f5; }
        .radio-option.selected { border-color: #666666; background: #f0f0f0; }
        .radio-option input[type="radio"] { margin-right: 14px; accent-color: #666666; }
        .radio-option label { margin: 0; text-transform: none; font-size: 14px; font-weight: 400; color: #1a1a1a; cursor: pointer; }
        .button-group { display: flex; gap: 12px; margin-top: 24px; }
        .back-btn { background: #e0e0e0; color: #666666; border: 1px solid #cccccc; padding: 18px; font-size: 12px; font-weight: 500; letter-spacing: 0.05em; cursor: pointer; transition: all 0.15s ease; text-transform: uppercase; flex: 0 0 80px; }
        .back-btn:hover { background: #d0d0d0; border-color: #bbbbbb; }
        .next-btn { background: #777777; color: #ffffff; border: 1px solid #999999; padding: 18px; font-size: 12px; font-weight: 500; letter-spacing: 0.05em; cursor: pointer; transition: all 0.15s ease; text-transform: uppercase; flex: 1; }
        .next-btn:hover { background: #666666; border-color: #888888; }
        .next-btn:disabled { background: #cccccc; border-color: #dddddd; cursor: not-allowed; }
        .price-display { background: #f8f8f8; border: 1px solid #e0e0e0; padding: 24px; margin-bottom: 24px; }
        .price-row { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 14px; }
        .price-row:last-child { margin-bottom: 0; font-weight: 500; border-top: 1px solid #d0d0d0; padding-top: 12px; color: #1a1a1a; }
        .price-row span:first-child { color: #666666; }
        .terms { background: #f8f8f8; border: 1px solid #e0e0e0; padding: 20px; font-size: 12px; line-height: 1.6; margin-bottom: 24px; max-height: 220px; overflow-y: auto; color: #444444; }
        .terms p { margin-bottom: 12px; }
        .signature-container { border: 1px solid #cccccc; background: #fafafa; margin-bottom: 24px; }
        .signature-label { padding: 12px 16px; background: #eeeeee; border-bottom: 1px solid #cccccc; font-size: 11px; text-transform: uppercase; letter-spacing: 0.02em; color: #666666; font-weight: 500; }
        #signatureCanvas { display: block; width: 100%; height: 120px; cursor: crosshair; background: #ffffff; touch-action: none; }
        .signature-controls { padding: 12px 16px; background: #f5f5f5; border-top: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center; }
        .clear-signature { background: none; border: 1px solid #cccccc; color: #666666; padding: 6px 12px; font-size: 11px; cursor: pointer; text-transform: uppercase; letter-spacing: 0.02em; transition: all 0.15s ease; }
        .clear-signature:hover { border-color: #999999; color: #444444; }
        .signature-status { font-size: 11px; color: #666666; }
        .signature-status.signed { color: #555555; }
        .final-screen { text-align: left; padding: 32px 24px; }
        .final-screen h2 { color: #1a1a1a; margin-bottom: 16px; font-weight: 400; }
        .final-screen p { color: #666666; margin-bottom: 32px; }
        .results-section { background: #f8f8f8; border: 1px solid #e0e0e0; padding: 24px; margin-top: 24px; }
        .results-section h3 { font-size: 14px; font-weight: 500; margin-bottom: 16px; color: #1a1a1a; text-transform: uppercase; letter-spacing: 0.02em; }
        .result-item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; }
        .result-item:last-child { margin-bottom: 0; }
        .result-label { color: #666666; font-weight: 400; }
        .result-value { color: #1a1a1a; font-weight: 500; }
        .progress { height: 2px; background: #e8e8e8; }
        .progress-bar { height: 100%; background: #888888; transition: width 0.3s ease; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="../web/soldoutlogo.png" alt="Sold Out Logo" class="header-logo">
            <div class="header-content">
                <h1>Sell Your Merch</h1>
                <p>Note: Please consult with an appraiser when filling out this form.</p>
            </div>
        </div>
        
        <div class="progress">
            <div class="progress-bar" style="width: 16.67%"></div>
        </div>
        
        <div class="form-section active" id="step1">
            <h2>You</h2>
            <p>Well, you don't need to consult with anyone for this part... hopefully.</p>
            <div class="form-group">
                <label for="name">Seller (required)</label>
                <input type="text" id="name" required>
                <div class="error-message" id="nameError"></div>
            </div>
            <div class="form-group">
                <label for="email">Email (required and validated)</label>
                <input type="email" id="email" required>
                <div class="error-message" id="emailError"></div>
            </div>
            <div class="button-group">
                <button class="next-btn" id="step1Next">NEXT ≫</button>
            </div>
        </div>
        
        <div class="form-section" id="step2">
            <h2>Whatcha got there?</h2>
            <p>Briefly describe your item.</p>
            <div class="form-group">
                <textarea id="description" rows="4" placeholder="Family heirloom lava lamp"></textarea>
            </div>
            <div class="button-group">
                <button class="back-btn" id="step2Back">≪ BACK</button>
                <button class="next-btn" id="step2Next">NEXT ≫</button>
            </div>
        </div>
        
        <div class="form-section" id="step3">
            <h2>How much ya want for it?</h2>
            <p>This is the amount you will get if your item sells. No more, no less.</p>
            <div class="form-group">
                <label for="salePrice">Sale Price ($)</label>
                <input type="number" id="salePrice" min="1" step="0.01" placeholder="10.00" value="10.00">
            </div>
            <div class="button-group">
                <button class="back-btn" id="step3Back">≪ BACK</button>
                <button class="next-btn" id="step3Next">NEXT ≫</button>
            </div>
        </div>
        
        <div class="form-section" id="step4">
            <h2>Price Breakdown</h2>
            <div class="price-display">
                <div class="price-row">
                    <span>Sale Price:</span>
                    <span id="displaySalePrice"><strong>$10.00</strong></span>
                </div>
                <div class="price-row">
                    <span>Listing Price:</span>
                    <span id="displayListingPrice"><strong>$11.00</strong></span>
                </div>
            </div>
            <div class="button-group">
                <button class="back-btn" id="step4Back">≪ BACK</button>
                <button class="next-btn" id="step4Next">NEXT ≫</button>
            </div>
        </div>
        
        <div class="form-section" id="step5">
            <h2>Are you a Master Thespian?!</h2>
            <p>If so, do you want to go on stage to sell your item?</p>
            <div class="radio-group">
                <div class="radio-option" data-value="insist">
                    <input type="radio" name="performance" value="insist" id="insist">
                    <label for="insist">Yes, I insist</label>
                </div>
                <div class="radio-option" data-value="willing">
                    <input type="radio" name="performance" value="willing" id="willing">
                    <label for="willing">I'm willing to</label>
                </div>
                <div class="radio-option" data-value="no">
                    <input type="radio" name="performance" value="no" id="no">
                    <label for="no">Oh hell no!</label>
                </div>
            </div>
            <div class="button-group">
                <button class="back-btn" id="step5Back">≪ BACK</button>
                <button class="next-btn" id="step5Next">NEXT ≫</button>
            </div>
        </div>
        
        <div class="form-section" id="step6">
            <h2>Please sign below.</h2>
            <div class="terms">
                <p><strong>By signing below, I acknowledge that my item will be auctioned during the SOLD OUT! Comedy Show.</strong></p>
                <p>I understand that my item will only be sold if it reaches the listing price which will be higher than the sale price you chose. Site fees, transaction fees and taxes will be added to the sale price to create the listing price.</p>
                <p>If sold, I will receive the exact sale amount I've specified—no more, no less.</p>
                <p>Any amount above sale price will be retained by SOLD OUT! Comedy.</p>
                <p>I agree to have the item sold in the show format as determined by the production team.</p>
                <p>The production team has final say regarding my participation in the show.</p>
                <p>All sales are final with no returns or refunds.</p>
                <p>I release SOLD OUT! Comedy from any liability related to my item or participation.</p>
            </div>
            <div class="signature-container">
                <div class="signature-label">Digital Signature</div>
                <canvas id="signatureCanvas" width="400" height="120"></canvas>
                <div class="signature-controls">
                    <span class="signature-status" id="signatureStatus">Please sign above</span>
                    <button class="clear-signature" id="clearSig">Clear</button>
                </div>
            </div>
            <div class="button-group">
                <button class="back-btn" id="step6Back">≪ BACK</button>
                <button class="next-btn" id="finalSubmit" disabled>NEXT ≫</button>
            </div>
        </div>
        
        <div class="form-section" id="final">
            <div class="final-screen">
                <h2>Sold! ... hopefully.</h2>
                <p>Give the appraiser your boxed item. Check your email for your receipt and your item ID, which you'll need to listen for if you're performing. Make sure you received the receipt to confirm your email address is correct for payment.</p>
                <div class="results-section">
                    <h3>Form Results</h3>
                    <div class="result-item"><span class="result-label">Item ID:</span><span class="result-value" id="resultItemId"></span></div>
                    <div class="result-item"><span class="result-label">Seller:</span><span class="result-value" id="resultName"></span></div>
                    <div class="result-item"><span class="result-label">Email:</span><span class="result-value" id="resultEmail"></span></div>
                    <div class="result-item"><span class="result-label">Description:</span><span class="result-value" id="resultDescription"></span></div>
                    <div class="result-item"><span class="result-label">Sale Price:</span><span class="result-value" id="resultSalePrice"></span></div>
                    <div class="result-item"><span class="result-label">Listing Price:</span><span class="result-value" id="resultListingPrice"></span></div>
                    <div class="result-item"><span class="result-label">Perform:</span><span class="result-value" id="resultPerformance"></span></div>
                    <div class="result-item"><span class="result-label">Signature:</span><span class="result-value" id="resultSignature"></span></div>
                </div>
            </div>
        </div>
    </div>

<script>
// Configuration - Replaced by GitHub Actions during deployment
const CONFIG = {
    AIRTABLE_API_KEY: '{{AIRTABLE_API_KEY}}',
    AIRTABLE_BASE_ID: '{{AIRTABLE_BASE_ID}}',
    AIRTABLE_TABLE_NAME: '{{AIRTABLE_TABLE_NAME}}',
    EMAILJS_SERVICE_ID: '{{EMAILJS_SERVICE_ID}}',
    EMAILJS_TEMPLATE_ID: '{{EMAILJS_TEMPLATE_ID}}',
    EMAILJS_PUBLIC_KEY: '{{EMAILJS_PUBLIC_KEY}}',
    FEES_PERCENTAGE: 0.1
};

let currentStep = 1;
let formData = { itemId: Math.floor(Math.random() * 9000) + 1000, fees: CONFIG.FEES_PERCENTAGE };
let canvas, ctx, isDrawing = false, hasSigned = false;

function validateEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

function validateStep1() {
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    let isValid = true;
    document.getElementById('nameError').textContent = '';
    document.getElementById('emailError').textContent = '';
    document.getElementById('name').classList.remove('error');
    document.getElementById('email').classList.remove('error');
    if (!name) {
        document.getElementById('nameError').textContent = 'Seller name is required';
        document.getElementById('name').classList.add('error');
        isValid = false;
    }
    if (!email) {
        document.getElementById('emailError').textContent = 'Email is required';
        document.getElementById('email').classList.add('error');
        isValid = false;
    } else if (!validateEmail(email)) {
        document.getElementById('emailError').textContent = 'Please enter a valid email address';
        document.getElementById('email').classList.add('error');
        isValid = false;
    }
    return isValid;
}

function nextStep(step) {
    console.log('nextStep called with step:', step);
    if (step === 1 && !validateStep1()) return;
    if (step === 3) {
        const salePrice = parseFloat(document.getElementById('salePrice').value);
        if (!salePrice || salePrice < 1) { alert('Sale price must be at least $1.00'); return; }
        const listingPrice = salePrice + (salePrice * formData.fees);
        document.getElementById('displaySalePrice').innerHTML = '<strong>$' + salePrice.toFixed(2) + '</strong>';
        document.getElementById('displayListingPrice').innerHTML = '<strong>$' + listingPrice.toFixed(2) + '</strong>';
        formData.salePrice = salePrice; formData.listingPrice = listingPrice;
    }
    currentStep++; showStep(currentStep); updateProgress();
}

function previousStep() {
    if (currentStep > 1) { currentStep--; showStep(currentStep); updateProgress(); }
}

function showStep(step) {
    document.querySelectorAll('.form-section').forEach(section => section.classList.remove('active'));
    document.getElementById('step' + step).classList.add('active');
    if (step === 6) setTimeout(initSignaturePad, 100);
}

function updateProgress() {
    document.querySelector('.progress-bar').style.width = (currentStep / 6) * 100 + '%';
}

function selectRadio(value) {
    document.querySelectorAll('.radio-option').forEach(option => option.classList.remove('selected'));
    document.querySelectorAll('input[name="performance"]').forEach(radio => radio.checked = false);
    const selected = document.querySelector('.radio-option[data-value="' + value + '"]');
    selected.classList.add('selected');
    document.getElementById(value).checked = true;
    formData.performance = value;
}

function initSignaturePad() {
    canvas = document.getElementById('signatureCanvas');
    ctx = canvas.getContext('2d');
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * 2; 
    canvas.height = rect.height * 2;
    ctx.scale(2, 2); 
    ctx.strokeStyle = '#555555'; 
    ctx.lineWidth = 2; 
    ctx.lineCap = 'round';
    
    // Mouse events
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    
    // Touch events for mobile
    canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
    canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
    canvas.addEventListener('touchend', stopDrawing);
    canvas.addEventListener('touchcancel', stopDrawing);
}

function getEventPos(e) {
    const rect = canvas.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    return {
        x: clientX - rect.left,
        y: clientY - rect.top
    };
}

function handleTouchStart(e) {
    e.preventDefault(); // Prevent scrolling
    const pos = getEventPos(e);
    isDrawing = true;
    ctx.beginPath();
    ctx.moveTo(pos.x, pos.y);
}

function handleTouchMove(e) {
    e.preventDefault(); // Prevent scrolling
    if (!isDrawing) return;
    const pos = getEventPos(e);
    draw({ clientX: pos.x + canvas.getBoundingClientRect().left, clientY: pos.y + canvas.getBoundingClientRect().top });
}

function startDrawing(e) {
    isDrawing = true; 
    ctx.beginPath();
    const pos = getEventPos(e);
    ctx.moveTo(pos.x, pos.y);
}

function draw(e) {
    if (!isDrawing) return;
    const pos = getEventPos(e);
    ctx.lineTo(pos.x, pos.y); 
    ctx.stroke();
    if (!hasSigned) {
        hasSigned = true;
        document.getElementById('signatureStatus').textContent = 'Signed';
        document.getElementById('finalSubmit').disabled = false;
    }
}

function stopDrawing() { 
    isDrawing = false; 
}

function clearSignature() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    hasSigned = false;
    document.getElementById('signatureStatus').textContent = 'Please sign above';
    document.getElementById('finalSubmit').disabled = true;
}

async function submitForm() {
    formData.name = document.getElementById('name').value;
    formData.email = document.getElementById('email').value;
    formData.description = document.getElementById('description').value;
    formData.signatureData = canvas.toDataURL();
    const btn = document.getElementById('finalSubmit');
    btn.textContent = 'SUBMITTING...'; btn.disabled = true;
    try {
        await submitToAirtable(formData);
        await sendEmailConfirmation(formData);
        showSuccessScreen();
    } catch (error) {
        alert('Error: ' + error.message);
        btn.textContent = 'NEXT ≫'; btn.disabled = false;
    }
}

async function submitToAirtable(data) {
    const labels = { 'insist': 'Yes, I insist', 'willing': "I'm willing to", 'no': 'Oh hell no!' };
    const response = await fetch(`https://api.airtable.com/v0/${CONFIG.AIRTABLE_BASE_ID}/${CONFIG.AIRTABLE_TABLE_NAME}`, {
        method: 'POST',
        headers: { 
            'Authorization': `Bearer ${CONFIG.AIRTABLE_API_KEY}`, 
            'Content-Type': 'application/json' 
        },
        body: JSON.stringify({ 
            fields: { 
                'Item ID': data.itemId, 
                'Seller': data.name, 
                'Email': data.email, 
                'Description': data.description || 'No description provided', 
                'Sale Price': data.salePrice, 
                'Listing Price': data.listingPrice, 
                'Perform': labels[data.performance] || 'Not selected', 
                'Signature Data': data.signatureData 
            } 
        })
    });
    if (!response.ok) throw new Error('Airtable failed');
}

async function sendEmailConfirmation(data) {
    const labels = { 'insist': 'Yes, I insist', 'willing': "I'm willing to", 'no': 'Oh hell no!' };
    await emailjs.send(CONFIG.EMAILJS_SERVICE_ID, CONFIG.EMAILJS_TEMPLATE_ID, {
        seller_name: data.name, 
        seller_email: data.email, 
        item_id: data.itemId,
        description: data.description || 'No description provided',
        sale_price: '$' + data.salePrice.toFixed(2), 
        listing_price: '$' + data.listingPrice.toFixed(2),
        performance: labels[data.performance] || 'Not selected'
    }, CONFIG.EMAILJS_PUBLIC_KEY);
}

function showSuccessScreen() {
    const labels = { 'insist': 'Yes, I insist', 'willing': "I'm willing to", 'no': 'Oh hell no!' };
    document.getElementById('resultItemId').textContent = formData.itemId;
    document.getElementById('resultName').textContent = formData.name;
    document.getElementById('resultEmail').textContent = formData.email;
    document.getElementById('resultDescription').textContent = formData.description || 'No description provided';
    document.getElementById('resultSalePrice').textContent = '$' + formData.salePrice.toFixed(2);
    document.getElementById('resultListingPrice').textContent = '$' + formData.listingPrice.toFixed(2);
    document.getElementById('resultPerformance').textContent = labels[formData.performance] || 'Not selected';
    document.getElementById('resultSignature').textContent = hasSigned ? 'Signed' : 'Not signed';
    document.querySelectorAll('.form-section').forEach(section => section.classList.remove('active'));
    document.getElementById('final').classList.add('active');
    document.querySelector('.progress-bar').style.width = '100%';
}

document.addEventListener('DOMContentLoaded', function() {
    updateProgress();
    document.getElementById('step1Next').addEventListener('click', () => nextStep(1));
    document.getElementById('step2Back').addEventListener('click', previousStep);
    document.getElementById('step2Next').addEventListener('click', () => nextStep(2));
    document.getElementById('step3Back').addEventListener('click', previousStep);
    document.getElementById('step3Next').addEventListener('click', () => nextStep(3));
    document.getElementById('step4Back').addEventListener('click', previousStep);
    document.getElementById('step4Next').addEventListener('click', () => nextStep(4));
    document.getElementById('step5Back').addEventListener('click', previousStep);
    document.getElementById('step5Next').addEventListener('click', () => nextStep(5));
    document.getElementById('step6Back').addEventListener('click', previousStep);
    document.getElementById('finalSubmit').addEventListener('click', submitForm);
    document.getElementById('clearSig').addEventListener('click', clearSignature);
    document.querySelectorAll('.radio-option').forEach(option => {
        option.addEventListener('click', () => selectRadio(option.dataset.value));
    });
});
</script>
</body>
</html>